version: '3.8'

services:
  maestro-front:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: maestro-front
    ports:
      - "8501:8501"
    environment:
      # Database
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_HOST=${POSTGRES_HOST}
      - POSTGRES_PORT=${POSTGRES_PORT}
      - DATABASE_URL=${DATABASE_URL}

      # Client Configuration
      - DEFAULT_CLIENT_ID=${DEFAULT_CLIENT_ID}

      # API Keys (opcional)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - AZURE_DEVOPS_TOKEN=${AZURE_DEVOPS_TOKEN:-}
      - JIRA_API_KEY=${JIRA_API_KEY:-}

      # Observability (Grafana, Prometheus, Loki)
      - GRAFANA_URL=${GRAFANA_URL:-http://200.229.76.122:3000}
      - GRAFANA_USER=${GRAFANA_USER:-admin}
      - GRAFANA_PASS=${GRAFANA_PASS:-maestro2024}
      - LOKI_URL=${LOKI_URL:-http://200.229.76.122:3100}
      - PROMETHEUS_METRICS_PORT=${PROMETHEUS_METRICS_PORT:-9464}
    volumes:
      - ./assets:/app/assets:ro
      - ./components:/app/components:ro
      - ./database:/app/database:ro
      - ./observability:/app/observability:ro
      - ./repositories:/app/repositories:ro
    restart: unless-stopped
    networks:
      - maestro-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  maestro-network:
    driver: bridge
